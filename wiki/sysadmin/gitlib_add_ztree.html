<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="Stylesheet" type="text/css" href="../styles/style.css" />
    <title>用ztree给gitlab添加目录导航</title>
</head>
<body>
<div id="header">
    <ul id="top-nav">
    <li><a href="../index.html">首页</a></li>
    <li><a href="index.html">分类首页</a></li>
    </ul>
</div>
<div id="cse"></div>
<div id="main">

<h1>用ztree给gitlab添加目录导航</h1>
<div class="toc">
<ul>
<li><a href="#toc_0.1">给gitlab wiki添加TOC</a>
<ul>
<li><a href="#toc_0.1.1">外部加载方式</a>
<ul>
<li><a href="#toc_0.1.1.1">使用方法</a>
<li><a href="#toc_0.1.1.2">说明</a>
<li><a href="#toc_0.1.1.3">效果截图</a>
<li><a href="#toc_0.1.1.4">其它</a>
</ul>
<li><a href="#toc_0.1.2">添加到模板</a>
</ul>
<li><a href="#toc_0.2">Ztree及ztree_toc</a>
</ul>
</ul>
</div>

<p>
给gitlab的wiki和markdown页面生成目录导航(TOC:Table of Contents)，方便长篇Wiki内容的翻阅。
</p>


<h2 id="toc_0.1">给gitlab wiki添加TOC</h2>

<h3 id="toc_0.1.1">外部加载方式</h3>

<p>
通过jquery加载外部JS，达到给Wiki和markdown页面添加目录导航目的，测试在Firefox、Chrome、Safari中工作正常。
</p>

<p>
因在浏览器用js实现，不需要具有服务器管理权限、修改服务端模板，在gitlab服务器、gitlab.com均可使用该方法。
</p>

<h4 id="toc_0.1.1.1">使用方法</h4>

<ul>
<li>
将下面的代码做为"地址(L)"添加到浏览器书签中：
<pre>
javascript:$('head').append("&lt;script src='"+window.location.protocol+"//xstarcd.github.io/wiki/files/ztreetoc/ldztree.js'&gt;&lt;script&gt;");void(0);
</pre>

</ul>
<p>
<img src="../files/ztreetoc/img/ZtreeToc_bookmark.png" alt="zTreeToc Bookmark">
</p>
<ul>
<li>
进入gitlab的Wiki页面、或者md/markdown文件查看页面;

<li>
在wiki/markdown页面加载完成后，点击该书签，约2-3秒即可显示出目录导航。

</ul>

<h4 id="toc_0.1.1.2">说明</h4>

<ol>
<li>
因资源加载和内容解析受网速影响，显示目录约需要2-3秒时间；

<li>
第一次使用可能因没有缓存而失败(如：空白的目录)，再点一次书签即可成功加载；

<li>
点击左上角的"HideToc"可隐藏/显示目录；

<li>
自动检测当前页面是wiki或markdown页面，才会生成导航，否则不会加载。

</ol>

<h4 id="toc_0.1.1.3">效果截图</h4>

<p>
<img src="../files/ztreetoc/img/ZtreeToc_ScreenShot.png" width="1000px" alt="zTreeToc ScreenShot">
</p>

<h4 id="toc_0.1.1.4">其它</h4>

<ul>
<li>
源码：<a href="gitlib_add_ztree_ldgitlabToc.html">ldztree.js</a>

<li>
已知问题：

<ul>
<li>
启用自动编号时(is_auto_number:true)时，所有标题上的链接会丢失。

<li>
github.com的HTTP Header中添加了CSP(Content Security Policy)控制，无法通过JS注入方式生成目录。
<pre>
content-security-policy: default-src *; script-src assets-cdn.github.com collector-cdn.github.com;...
</pre>

<li>
github的Wiki或markdown可在chrome浏览器中安装github-toc插件来实现：

<ul>
<li>
<a href="https://github.com/summerblue/github-toc">https://github.com/summerblue/github-toc</a>

<li>
<a href="https://chrome.google.com/webstore/detail/github-toc/nalkpgbfaadkpckoadhlkihofnbhfhek">https://chrome.google.com/webstore/detail/github-toc/nalkpgbfaadkpckoadhlkihofnbhfhek</a>

</ul>
</ul>
</ul>

<h3 id="toc_0.1.2">添加到模板</h3>

<p>
对于自己的gitlab服务器，可以将上面的ldztree.js添加到gitlabb模板中来实现自动加载目录导航。
</p>

<h2 id="toc_0.2">Ztree及ztree_toc</h2>

<ul>
<li>
ztree

<ul>
<li>
官网：<a href="http://www.ztree.me">http://www.ztree.me</a>

<li>
源码：

<ul>
<li>
<a href="https://github.com/i5ting/i5ting_ztree_toc">https://github.com/i5ting/i5ting_ztree_toc</a>

<li>
<a href="https://git.oschina.net/zTree/zTree_v3">https://git.oschina.net/zTree/zTree_v3</a>

</ul>
</ul>
<li>
i5ting_ztree_toc

<ul>
<li>
Demo：<a href="http://i5ting.github.io/i5ting_ztree_toc/build/jquery.plugin.html">http://i5ting.github.io/i5ting_ztree_toc/build/jquery.plugin.html</a>

<li>
介绍：<a href="https://ruby-china.org/topics/17028">https://ruby-china.org/topics/17028</a>

<li>
ztree_toc基础文件:<a href="../files/ztreetoc/ztree_3.5.tar.gz">ztree_3.5.tar.gz</a>

</ul>
</ul>

</div>
<div id="footer">
<p>
&copy; 2012 - 2021 XStar
&nbsp;|&nbsp;<a href="http://code.google.com/p/vimwiki/" title="vimwiki">Powerby:Vimwiki</a>
&nbsp;|&nbsp;<a href="http://kwiki.github.io" title="丘迟">Style:丘迟</a>
&nbsp;|&nbsp;<a href="../index.html">首页</a>
&nbsp;|&nbsp;<a href="index.html">分类首页</a>
&nbsp;|&nbsp;<a href="../SiteMap.html">站点地图</a>
</p>
</div>
<script type="text/javascript">var vimwiki_rootpath="../";</script>
<script type="text/javascript" src="https://cdn.staticfile.org/jquery/2.0.0/jquery.min.js"></script>
<script type="text/javascript" src="../scripts/vimwiki.js"></script>
</body>
</html>

